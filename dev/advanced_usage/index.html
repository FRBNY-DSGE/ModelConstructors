<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Advanced Usage · ModelConstructors.jl</title><link href="https://cdnjs.cloudflare.com/ajax/libs/normalize/4.2.0/normalize.min.css" rel="stylesheet" type="text/css"/><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.2.0/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link href="../assets/documenter.css" rel="stylesheet" type="text/css"/></head><body><nav class="toc"><a href="../index.html"><img class="logo" src="../assets/logo.png" alt="ModelConstructors.jl logo"/></a><h1>ModelConstructors.jl</h1><select id="version-selector" onChange="window.location.href=this.value" style="visibility: hidden"></select><form class="search" id="search-form" action="../search/"><input id="search-query" name="q" type="text" placeholder="Search docs"/></form><ul><li><a class="toctext" href="../">Home</a></li><li><a class="toctext" href="../model_design/">Model Design</a></li><li><a class="toctext" href="../running_existing_model/">Running An Existing Model</a></li><li class="current"><a class="toctext" href>Advanced Usage</a><ul class="internal"><li><a class="toctext" href="#Package-Directory-Structure-1">Package Directory Structure</a></li><li><a class="toctext" href="#Working-with-Settings-1">Working with Settings</a></li><li><a class="toctext" href="#editing-extending-model-1">Editing or Extending a Model</a></li></ul></li><li><a class="toctext" href="../input_data/">Input Data</a></li><li><a class="toctext" href="../frbny_data/">FRBNY Model Input Data</a></li><li><a class="toctext" href="../implementation_details/">Implementation Details</a></li><li><a class="toctext" href="../solving/">Solving the Model</a></li><li><a class="toctext" href="../estimation/">Estimation</a></li><li><a class="toctext" href="../forecast/">Forecasting</a></li><li><a class="toctext" href="../means_bands/">Computing Means and Bands</a></li><li><a class="toctext" href="../altpolicy/">Alternative Policies</a></li><li><a class="toctext" href="../scenarios/">Alternative Scenarios</a></li><li><a class="toctext" href="../plotting/">Plotting</a></li><li><a class="toctext" href="../algorithms/">Algorithms</a></li><li><a class="toctext" href="../contributing/">Contributing to DSGE.jl</a></li><li><a class="toctext" href="../MatlabToJuliaTransition/">MATLAB to Julia Transition: Estimation</a></li><li><a class="toctext" href="../julia_forecasting/">MATLAB to Julia Transition: Forecast</a></li><li><a class="toctext" href="../license/">License</a></li></ul></nav><article id="docs"><header><nav><ul><li><a href>Advanced Usage</a></li></ul><a class="edit-page" href="https://github.com/FRBNY-DSGE/ModelConstructors.jl/blob/master/docs/src/advanced_usage.md"><span class="fa"></span> Edit on GitHub</a></nav><hr/><div id="topbar"><span>Advanced Usage</span><a class="fa fa-bars" href="#"></a></div></header><h1><a class="nav-anchor" id="Advanced-Usage-1" href="#Advanced-Usage-1">Advanced Usage</a></h1><h2><a class="nav-anchor" id="Package-Directory-Structure-1" href="#Package-Directory-Structure-1">Package Directory Structure</a></h2><p>The package directory structure follows Julia module conventions. Directories in square brackets indicate future additions. <em>Note that this directory tree is not linked, although it appears to be.</em></p><ul><li><a href="../pkg_structure/#[DSGE.jl](https://github.com/FRBNY-DSGE/DSGE.jl)-1"><code>DSGE.jl</code></a></li><ul><li><a href="../pkg_structure/#doc/:-Code-and-model-documentation.-1"><code>doc/</code>: Code and model documentation.</a></li><li><a href="../pkg_structure/#save/:-Sample-input-files;-default-input/output-directories.-1"><code>save/</code>: Sample input files; default input/output directories.</a></li><li><a href="../pkg_structure/#src/-1"><code>src/</code></a></li><ul><li><a href="../pkg_structure/#DSGE.jl:-The-main-module-file.-1"><code>DSGE.jl</code>: The main module file.</a></li><li><a href="../pkg_structure/#abstractdsgemodel.jl:-Defines-the-AbstractModel-type.-1"><code>abstractdsgemodel.jl</code>: Defines the <code>AbstractModel</code> type.</a></li><li><a href="../pkg_structure/#parameters.jl:-Implements-the-AbstractParameter-type-and-its-subtypes.-1"><code>parameters.jl</code>: Implements the <code>AbstractParameter</code> type and its subtypes.</a></li><li><a href="../pkg_structure/#settings.jl:-Implements-the-Setting-type.-1"><code>settings.jl</code>: Implements the <code>Setting</code> type.</a></li><li><a href="../pkg_structure/#defaults.jl:-Specifies-default-Settings.-1"><code>defaults.jl</code>: Specifies default <code>Setting</code>s.</a></li><li><a href="../pkg_structure/#distributions_ext.jl:-DSGE-specific-extensions-of-Distributions-functionality.-1"><code>distributions_ext.jl</code>: DSGE-specific extensions of <code>Distributions</code> functionality.</a></li><li><a href="../pkg_structure/#data/:-Manipulating-and-updating-input-dataset.-1"><code>data/</code>: Manipulating and updating input dataset.</a></li><li><a href="../pkg_structure/#solve/:-Solving-the-model;-includes-gensys.jl-code.-1"><code>solve/</code>: Solving the model; includes <code>gensys.jl</code> code.</a></li><li><a href="../pkg_structure/#estimate/:-Optimization,-posterior-sampling,-and-other-functionality.-1"><code>estimate/</code>: Optimization, posterior sampling, and other functionality.</a></li><li><a href="../pkg_structure/#forecast/:-Forecasts,-smoothing,-shock-decompositions,-and-impulse-response-functions.-1"><code>forecast/</code>: Forecasts, smoothing, shock decompositions, and impulse response functions.</a></li><li><a href="../pkg_structure/#analysis/:-Moment-tables-of-estimated-parameters,-computation-of-forecast-means-and-bands.-1"><code>analysis/</code>: Moment tables of estimated parameters, computation of forecast means and bands.</a></li><li><a href="../pkg_structure/#altpolicy/:-Infrastructure-for-forecasting-under-alternative-monetary-policy-rules.-1"><code>altpolicy/</code>: Infrastructure for forecasting under alternative monetary policy rules.</a></li><li><a href="../pkg_structure/#scenarios/:-Forecasting-alternative-scenarios.-1"><code>scenarios/</code>: Forecasting alternative scenarios.</a></li><li><a href="../pkg_structure/#plot/:-Plot-estimation-results,-forecasts,-etc.-1"><code>plot/</code>: Plot estimation results, forecasts, etc.</a></li><li><a href="../pkg_structure/#models/-1"><code>models/</code></a></li><ul><li><a href="../pkg_structure/#m990/:-Contains-code-to-define-and-initialize-version-990-of-the-New-York-Fed-DSGE-model.-1"><code>m990/</code>: Contains code to define and initialize version 990 of the New York Fed DSGE model.</a></li><ul><li><a href="../pkg_structure/#m990.jl:-Constructs-a-Model990-object.-1"><code>m990.jl</code>: Constructs a <code>Model990</code> object.</a></li><li><a href="../pkg_structure/#eqcond.jl:-Constructs-Model990-equilibrium-condition-matrices-1"><code>eqcond.jl</code>: Constructs <code>Model990</code> equilibrium condition matrices</a></li><li><a href="../pkg_structure/#measurement.jl:-Constructs-Model990-measurement-equation-matrices.-1"><code>measurement.jl</code>: Constructs <code>Model990</code> measurement equation matrices.</a></li><li><a href="../pkg_structure/#pseudo_measurement.jl:-Constructs-Model990-pseudo-measurement-equation-matrices.-1"><code>pseudo_measurement.jl</code>: Constructs <code>Model990</code> pseudo-measurement equation matrices.</a></li><li><a href="../pkg_structure/#subspecs.jl:-Code-for-model-sub-specifications-is-defined-here.-See-[Editing-or-Extending-a-Model](@ref-editing-extending-model)-for-details-on-constructing-model-sub-specifications.-1"><code>subspecs.jl</code>: Code for model sub-specifications is defined here. See Editing or Extending a Model for details on constructing model sub-specifications.</a></li><li><a href="../pkg_structure/#augment_states.jl:-Code-for-augmenting-the-state-space-system-after-model-solution.-1"><code>augment_states.jl</code>: Code for augmenting the state space system after model solution.</a></li></ul><li><a href="../pkg_structure/#[[m991/]]:-Code-for-new-models-should-be-kept-in-directories-at-this-level-in-the-directory-tree-1">[<code>[m991/]</code>]: Code for new models should be kept in directories at this level in the directory tree</a></li></ul></ul><li><a href="../pkg_structure/#test/:-Module-test-suite.-1"><code>test/</code>: Module test suite.</a></li></ul></ul><h2><a class="nav-anchor" id="Working-with-Settings-1" href="#Working-with-Settings-1">Working with Settings</a></h2><p>There are many computational settings that affect how the code runs without affecting the mathematical definition of the model.</p><p>Below, we describe several important settings for package usage.</p><p>For more details on implementation and usage of settings, see <a href="../implementation_details/#Model-Settings-1">Model Settings</a>.</p><p>See <a href="https://github.com/FRBNY-DSGE/DSGE.jl/blob/master/src/defaults.jl">defaults.jl</a> for the complete description of default settings.</p><h4><a class="nav-anchor" id="General-1" href="#General-1">General</a></h4><ul><li><code>saveroot::String</code>: The root directory for model output.</li><li><code>use_parallel_workers::Bool</code>: Use available parallel workers in computations.</li><li><code>n_anticipated_shocks</code>: Number of anticipated policy shocks.</li></ul><h4><a class="nav-anchor" id="Data-and-I/O-1" href="#Data-and-I/O-1">Data and I/O</a></h4><ul><li><code>dataroot::String</code>: The root directory for model input data.</li><li><code>data_vintage::String</code>: Data vintage, formatted <code>yymmdd</code>. By default, <code>data_vintage</code> is set to today&#39;s date. It is (currently) the only setting printed to output filenames by default.</li><li><code>dataset_id::Int</code>: Dataset identifier. There should be a unique dataset ID for each set of observables.</li><li><code>cond_vintage::String</code>: Conditional data vintage, formatted <code>yymmdd</code>.</li><li><code>cond_id::Int</code>: Conditional dataset identifier. There should be a unique conditional dataset ID for each set of input, raw data mnemonics (not observables!).</li><li><code>cond_semi_names::Vector{Symbol}</code> and <code>cond_full_names::Vector{Symbol}</code>: names of observables for which we want to use semi- and full conditional data. All other observables are <code>NaN</code>ed out in the conditional data periods.</li><li><code>population_mnemonic::Nullable{Symbol}</code>: population series mnemonic in form <code>Nullable(:&lt;mnemonic&gt;__&lt;source&gt;)</code> (for example, <code>Nullable(:CNP16OV__FRED)</code>), or <code>Nullable{Symbol}()</code> if the model doesn&#39;t use population data</li></ul><h4><a class="nav-anchor" id="Dates-1" href="#Dates-1">Dates</a></h4><ul><li><code>date_presample_start::Date</code>: Start date of pre-sample.</li><li><code>date_mainsample_start::Date</code>: Start date of main sample.</li><li><code>date_zlb_start::Date</code>: Start date of zero lower bound regime.</li><li><code>date_zlb_end::Date</code>: End date of zero lower bound regime.</li><li><code>date_forecast_start::Date</code>: Start date of forecast period (or the period after the last period for which we have GDP data).</li><li><code>date_forecast_end::Date</code>: End date of forecast, i.e. how far into the future to forecast.</li><li><code>date_conditional_end::Date</code>: Last date for which we have conditional data. This is typically the same as <code>date_forecast_start</code> when we condition on nowcasts and current quarter financial data.</li></ul><h4><a class="nav-anchor" id="Estimation-1" href="#Estimation-1">Estimation</a></h4><ul><li><p><code>reoptimize::Bool</code>: Whether to reoptimize the posterior mode. If <code>true</code> (the   default), <code>estimate</code> begins reoptimizing from the model object&#39;s parameter   vector.  See <a href="../estimation/#estimation-reoptimizing-1">Optimizing or Reoptimizing</a> for   more details.</p></li><li><p><code>calculate_hessian::Bool</code>: Whether to compute the Hessian. If <code>true</code> (the   default), <code>estimate</code> calculates the Hessian at the posterior mode.</p></li><li><p><code>n_mh_simulations::Int</code>: Number of draws from the posterior distribution per block.</p></li><li><p><code>n_mh_blocks::Int</code>: Number of blocks to run Metropolis-Hastings.</p></li><li><p><code>n_mh_burn::Int</code>: Number of blocks to discard as burn-in for Metropolis-Hastings.</p></li><li><p><code>mh_thin::Int</code>: Metropolis-Hastings thinning step.</p></li><li><p><code>parallel::Bool</code>: Flag for running algorithm in parallel.</p></li><li><p><code>n_parts::Int</code>: Number of particles.</p></li><li><p><code>n_blocks::Int</code>: Number of parameter blocks in mutation step.</p></li><li><p><code>n_mh_steps::Int</code>: Number of Metropolis Hastings steps to attempt during the mutation step.</p></li><li><p><code>λ::S</code>: The &#39;bending coefficient&#39; λ in Φ(n) = (n/N(Φ))^λ</p></li><li><p><code>n_Φ::Int</code>: Number of stages in the tempering schedule.</p></li><li><p><code>resampling_method::Symbol</code>: Which resampling method to use.</p><ul><li><code>:systematic</code>: Will use sytematic resampling.</li><li><code>:multinomial</code>: Will use multinomial resampling.</li><li><code>:polyalgo</code>: Samples using a polyalgorithm.</li></ul></li><li><p><code>threshold_ratio::S</code>: Threshold s.t. particles will be resampled when the population   drops below threshold * N</p></li><li><p><code>c::S</code>: Scaling factor for covariance of the particles. Controls size of steps in mutation step.</p></li><li><p><code>α::S</code>: The mixture proportion for the mutation step&#39;s proposal distribution.</p></li><li><p><code>target::S</code>: The initial target acceptance rate for new particles during mutation.</p></li><li><p><code>use_chand_recursion::Bool</code>: Flag for using Chandrasekhar Recursions in Kalman filter.</p></li><li><p><code>use_fixed_schedule::Bool</code>: Flag for whether or not to use a fixed tempering (ϕ) schedule.</p></li><li><p><code>tempering_target::S</code>: Coefficient of the sample size metric to be targeted when solving   for an endogenous ϕ.</p></li><li><p><code>old_data::Matrix{S}</code>:</p></li><li><p><code>old_cloud::ParticleCloud</code>:</p></li><li><p><code>old_vintage::String</code>: String for vintage date of old data</p></li><li><p><code>smc_iteration::Int</code>: The iteration index for the number of times SMC has been run on the    same data vintage. Primarily for numerical accuracy/testing purposes.</p></li><li><p><code>run_test::Bool</code>: Flag for when testing accuracy of program</p></li><li><p><code>filestring_addl::Vector{String}</code>: Additional file string extension for loading old cloud.</p></li><li><p><code>continue_intermediate::Bool</code>: Flag to indicate whether one is continuing SMC from an   intermediate stage/</p></li><li><p><code>intermediate_stage_start::Int</code>: Intermediate stage at which one wishes to begin the estimation.</p></li><li><p><code>save_intermediate::Bool</code>: Flag for whether one wants to save intermediate Cloud objects</p></li><li><p><code>intermediate_stage_increment::Int</code>: Save Clouds at every increment   (1 = each stage, 10 = every 10th stage, etc.)</p></li></ul><h4><a class="nav-anchor" id="Forecasting-1" href="#Forecasting-1">Forecasting</a></h4><ul><li><code>forecast_jstep::Int</code>: Forecast thinning step.</li><li><code>forecast_block_size::Int</code>: Number of draws in each forecast block <em>before</em> thinning by <code>forecast_jstep</code>.</li><li><code>forecast_input_file_overrides::Dict{Symbol, String}</code>: Maps <code>input_type</code>(s) to the file name containing input draws for that type of forecast. See <a href="#Forecasting-1">Forecasting</a>.</li><li><code>forecast_horizons::Int</code>: Number of periods to forecast.</li><li><code>impulse_response_horizons::Int</code>: Number of periods for which to calculate IRFs.</li></ul><h4><a class="nav-anchor" id="Alternative-Policy-1" href="#Alternative-Policy-1">Alternative Policy</a></h4><ul><li><code>alternative_policy::AltPolicy</code>: See <a href="../altpolicy/#Alternative-Policies-1">Alternative Policies</a>.</li></ul><h3><a class="nav-anchor" id="Accessing-Settings-1" href="#Accessing-Settings-1">Accessing Settings</a></h3><p>The function <code>get_setting(m::AbstractModel, s::Symbol)</code> returns the value of the setting <code>s</code> in <code>m.settings</code>. Some settings also have explicit getter methods that take only the model object <code>m</code> as an argument. Note that not all are exported.</p><h3><a class="nav-anchor" id="Overwriting-Default-Settings-1" href="#Overwriting-Default-Settings-1">Overwriting Default Settings</a></h3><p>To overwrite default settings added during model construction, a user must create a <code>Dict{Symbol, Setting}</code> and pass that into the model constructor as the keyword argument <code>custom_settings</code>. If the <code>print</code>, <code>code</code>, and <code>description</code> fields of the new <code>Setting</code> object are not provided, the fields of the existing setting will be maintained. If new values for <code>print</code>, <code>code</code>, and <code>description</code> are specified, and if these new values are distinct from the defaults for those fields, the fields of the existing setting will be updated.</p><p>For example, overwriting <code>use_parallel_workers</code> should look like this:</p><pre><code class="language-julia">custom_settings = Dict{Symbol, Setting}(
    :use_parallel_workers =&gt; Setting(:use_parallel_workers, true))
m = Model990(custom_settings = custom_settings)</code></pre><p>Or like this:</p><pre><code class="language-julia">m = Model990()
m &lt;= Setting(:use_parallel_workers, true)</code></pre><p>Note that using this second method will not work for all settings, e.g. <code>n_anticipated_shocks</code> is a setting that must be passed into the model during construction, as in the first example.</p><p>By default, passing in <code>custom_settings</code> overwrites the entries in the model object&#39;s <code>settings</code> field. However, with the additional keyword argument <code>testing = true</code>, it will overwrite the entries in <code>test_settings</code>:</p><pre><code class="language-julia">m = Model990(custom_settings = custom_settings, testing = true)</code></pre><h2><a class="nav-anchor" id="editing-extending-model-1" href="#editing-extending-model-1">Editing or Extending a Model</a></h2><p>Users may want to extend or edit <code>Model990</code> in a number of different ways.  The most common changes are listed below, in decreasing order of complexity:</p><ol><li>Add new parameters</li><li>Modify equilibrium conditions or measurement equations</li><li>Change the values of various parameter fields (i.e. initial <code>value</code>, <code>prior</code>, <code>transform</code>, etc.)</li><li>Change the values of various computational settings (i.e. <code>reoptimize</code>, <code>n_mh_blocks</code>)</li></ol><p>Points 1 and 2 often go together (adding a new parameter guarantees a change in equilibrium conditions), and are such fundamental changes that they increment the model specification number and require the definition of a new subtype of <code>AbstractModel</code> (for instance, <code>Model991</code>).  See <a href="#model-specification-mspec-1">Model specification</a> for more details.</p><p>Any changes to the initialization of preexisting parameters are defined as a new model <em>sub-specification</em>, or <em>subspec</em>. While less significant than a change to the model&#39;s equilibrium conditions, changing the values of some parameter fields (especially priors) can have economic significance over and above settings we use for computational purposes. <strong>Parameter definitions should not be modified in the model object&#39;s constructor.</strong> First, incrementing the model&#39;s sub-specification number when parameters are changed improves model-level (as opposed to code-level) version control. Second, it avoids potential output filename collisions, preventing the user from overwriting output from previous estimations with the original parameters. The protocol for defining new sub-specifications is described in <a href="#model-sub-specifications-msubspec-1">Model sub-specifications</a>.</p><p>Overriding default settings is described in the <a href="../implementation_details/#Model-Settings-1">Model Settings</a> section.</p><h3><a class="nav-anchor" id="model-specification-mspec-1" href="#model-specification-mspec-1">Model specification (<code>m.spec</code>)</a></h3><p>A particular model, which corresponds to a subtype of <code>AbstractModel</code>, is defined as a set of parameters, equilibrium conditions (defined by the <code>eqcond</code> function) and measurement equations (defined by the <code>measurement</code> function).  Therefore, the addition of new parameters, states, or observables, or any changes to the equilibrium conditions or measurement equations necessitate the creation of a new subtype of <code>AbstractModel.</code></p><p>To create a new model object, we recommend doing the following:</p><ol><li>Duplicate the <code>m990</code> directory within the <a href="https://github.com/FRBNY-DSGE/DSGE.jl/tree/master/src/models">models</a> directory. Name the new directory <code>mXXX.jl</code>, where <code>XXX</code> is your chosen model specification number or string. Rename <code>m990.jl</code> in this directory to <code>mXXX.jl</code>.</li><li>In the <code>mXXX/</code> directory, change all references to <code>Model990</code> to <code>ModelXXX</code>.</li><li>Edit the <code>m990.jl</code>, <code>eqcond.jl</code>, and <code>measurement.jl</code> files as you see fit.  If adding new states, equilibrium conditions, shocks, or observables, be sure to add them to the appropriate list in <code>init_model_indices</code>.</li><li>Open the module file, <code>src/DSGE.jl</code>. Add <code>ModelXXX</code> to the list of functions to export, and include each of the files in <code>src/model/mXXX</code>.</li></ol><h3><a class="nav-anchor" id="model-sub-specifications-msubspec-1" href="#model-sub-specifications-msubspec-1">Model sub-specifications (<code>m.subspec</code>)</a></h3><p><code>Model990</code> sub-specifications are initialized by overwriting initial parameter definitions before the model object is fully constructed. This happens via a call to <code>init_subspec</code> in the <code>Model990</code> constructor. (Clearly, an identical protocol should be followed for new model types as well.)</p><p>To create a new sub-specification (e.g., subspec 1) of <code>Model990</code>, edit the file <code>src/models/subspecs.jl</code> as follows (note that this example is not actually sub-specification <code>1</code> of <code>Model990</code>. In the source code, our sub-specification <code>5</code> is provided as additional example.):</p><p><strong>Step 1.</strong> Define a new function, <code>ss1</code>, that takes an object of type <code>Model990</code> (not    <code>AbstractModel</code>!) as an argument. In this function, construct new parameter objects and    overwrite existing model parameters using the <code>&lt;=</code> syntax. For example,</p><pre><code class="language-julia">function ss1(m::Model990)
    m &lt;= parameter(:ι_w, 0.000, (0.0, .9999), (0.0,0.9999), DSGE.Untransformed(), Normal(0.0,1.0), fixed=false,
                   description=&quot;ι_w: Some description.&quot;,
                   tex_label=&quot;\\iota_w&quot;)
    m &lt;= parameter(:ι_p, 0.0, fixed=true,
                   description= &quot;ι_p: Some description&quot;
                   tex_label=&quot;\\iota_p&quot;)
end</code></pre><p><strong>Step 2.</strong> Add an <code>elseif</code> condition to <code>init_subspec</code>:</p><pre><code class="language-julia">    ...
    elseif subspec(m) == &quot;ss1&quot;
        return ss1(m)
    ...</code></pre><p>To construct an instance of <code>Model990</code>, <code>ss1</code>, call the constructor for <code>Model990</code> with <code>ss1</code> as an argument. For example,</p><pre><code class="language-julia">m = Model990(&quot;ss1&quot;)</code></pre><footer><hr/><a class="previous" href="../running_existing_model/"><span class="direction">Previous</span><span class="title">Running An Existing Model</span></a><a class="next" href="../input_data/"><span class="direction">Next</span><span class="title">Input Data</span></a></footer></article></body></html>
